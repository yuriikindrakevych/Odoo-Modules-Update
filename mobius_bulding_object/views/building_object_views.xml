<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_building_object_form" model="ir.ui.view">
        <field name="name">building.object.form</field>
        <field name="model">building.object</field>
        <field name="arch" type="xml">
            <form string="Building Object">
                <header>
                    <button name="create_offer" type="object" string="Create Offer" class="oe_highlight"
                        attrs="{'invisible': ['|', ('state', 'in', ['cancel', 'done']), ('show_button_cancel', '=', False)]}"/>
                    <button name="button_cancel" type="object" string="Cancel"
                            class="oe_highlight"
                            attrs="{'invisible': ['|', ('show_button_cancel', '=', True), ('state', '=', 'cancel')]}">
                    </button>
                    <button name="button_renew" type="object" string="Renew"
                            class="oe_highlight"
                            attrs="{'invisible': ['|', ('state', '!=', 'cancel'), ('state', '=', 'new')]}">
                    </button>
                    <field name="state" widget="statusbar" options="{'clickable': 1}"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_get_attachment_view"
                                type="object"
                                icon="fa-paperclip">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_value">
                                        <field name="attachment_number"/>
                                    </span>
                                    <span attrs="{'invisible': [('attachment_number', '=', 1)]}">
                                        Attachments
                                    </span>
                                    <span attrs="{'invisible': [('attachment_number', '!=', 1)]}">
                                        Attachment
                                    </span>
                                </div>
                        </button>
                        <button class="oe_stat_button"
                                name="open_crm_lead"
                                icon="fa-star"
                                type="object">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_value">
                                        <field name="crm_lead_count"/>
                                    </span>
                                    <span attrs="{'invisible': [('crm_lead_count', '=', 1)]}">
                                        Leads
                                    </span>
                                    <span attrs="{'invisible': [('crm_lead_count', '!=', 1)]}">
                                        Lead
                                    </span>
                                </div>
                        </button>
                        <button class="oe_stat_button"
                                name="open_sale_order"
                                icon="fa-dollar"
                                type="object">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_value">
                                        <field name="sale_order_count"/>
                                    </span>
                                    <span attrs="{'invisible': [('sale_order_count', '=', 1)]}">
                                        Sale Orders
                                    </span>
                                    <span attrs="{'invisible': [('sale_order_count', '!=', 1)]}">
                                        Sale Order
                                    </span>
                                </div>
                        </button>
                        <button name="action_show_crm_lead" type="object"
                            class="oe_stat_button" icon="fa-user"
                            attrs="{'invisible': [('crm_lead_id', '=', False)]}">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Lead</span>
                            </div>
                        </button>
                    </div>

                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name"/>
                        </h1>
                        <label for="seq_number"/>
                        <h1>
                            <field name="seq_number" options="{'format': 0}"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="show_button_cancel" invisible="1"/>
                            <field name="company_id" invisible="1"/>

                            <label for="crm_lead_id"/>
                            <div class="o_row">
                                <field name="crm_lead_id"/>
                            </div>

                            <label for="crm_lead_id_show" invisible="1"/>
                            <div class="o_row" invisible="1">
                                <field name="crm_lead_id_show"/>
                            </div>

                            <label for="partner_id"/>
                            <div class="o_row">
                                <field name="partner_id"/>
                            </div>

                            <label for="user_id"/>
                            <div class="o_row">
                                <field name="user_id"/>
                            </div>
                            <label for="team_id"/>
                            <div class="o_row">
                                <field name="team_id"/>
                            </div>
                        </group>
                        <group>
                        <!--
                            <label for="analytical_account"/>
                            <div class="o_row">
                                <field name="analytical_account"/>
                            </div>
                        -->
                            <label for="property_product_pricelist"/>
                            <div class="o_row">
                                <field name="property_product_pricelist"/>
                            </div>
                            <label for="date"/>
                            <div class="o_row">
                                <field name="date"/>
                            </div>
                        </group>
                    </group>
                    <group>
                        <label for="street" string="Address"/>
                        <div class="o_address_format">
                            <field name="street" placeholder="Street..." class="o_address_street"/>
                            <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                            <field name="city" placeholder="City" class="o_address_city"/>
                            <field name="state_id" class="o_address_state" placeholder="State" options='{"no_open": True}'/>
                            <field name="zip" placeholder="ZIP" class="o_address_zip"/>
                            <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                        </div>
                    </group>
<!--                     <group>
                        <field name="building_object_line">
                            <tree string="Line">
                                <field name="product_id" />
                                <field name="price_unit"/>
                                <field name="reserved"/>
                            </tree>
                        </field>
                    </group> -->
                    <notebook>
                        <page string="Order Lines" name="order_lines">
                            <field
                                name="building_object_line"
                                widget="section_and_note_one2many"
                                mode="tree"
                            >
                                <tree
                                    string="Sales Order Lines"
                                    editable="bottom"
                                >
                                    <control>
                                        <create name="add_product_control" string="Add a product"/>
                                    </control>

                                    <field name="sequence" widget="handle" />

                                    <field
                                        name="product_id"
                                        force_save="1"
                                        context="{
                                            'partner_id': parent.partner_id,
                                            'company_id': parent.company_id,
                                        }"
                                        domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                        widget="product_configurator"
                                    />
                                    <field name="price_unit"/>
                                    <field name="demand"/>
                                    <field name="reserved"/>
                                    <field name="full_reserved"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Additional Info" name="additional_info">
                            <group>
                                <group>
                                    <label for="total_power"/>
                                    <div class="o_row">
                                        <field name="total_power"/>
                                    </div>
                                    <label for="investor_id"/>
                                    <div class="o_row">
                                        <field name="investor_id"/>
                                    </div>
                                    <label for="designer_id"/>
                                    <div class="o_row">
                                        <field name="designer_id"/>
                                    </div>
                                    <label for="general_executor_id"/>
                                    <div class="o_row">
                                        <field name="general_executor_id"/>
                                    </div>
                                    <label for="installer_id"/>
                                    <div class="o_row">
                                        <field name="installer_id"/>
                                    </div>
                                </group>
                                <group>
                                    <group name="Terms of implementation">
                                        <label for="start_date"/>
                                        <div class="o_row">
                                            <field name="start_date"/>
                                        </div>
                                        <label for="end_date"/>
                                        <div class="o_row">
                                            <field name="end_date"/>
                                        </div>
                                    </group>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_building_object_form_confirm_order" model="ir.ui.view">
        <field name="name">building.object.form</field>
        <field name="model">building.object</field>
        <field name="arch" type="xml">
            <form string="Building Object" create="0" delete="0">
                <header>
                    <button name="fill_all_confirm_offer" type="object" string="Fill All" class="oe_highlight" />
                    <button name="clear_all_confirm_offer" type="object" string="Clear All" class="oe_highlight" />
                </header>
                <field name="company_id" invisible="1"/>
                <field name="partner_id" invisible="1"/>
                <field
                    name="building_object_line"
                    widget="one2many"
                    mode="tree"
                >
                    <tree
                        string="Sales Order Lines"
                        editable="bottom"
                    >
                        <field name="sequence" widget="handle" />
                        <field
                            name="product_id"
                            force_save="1"
                            context="{
                                'partner_id': parent.partner_id,
                                'company_id': parent.company_id,
                            }"
                            attrs="{'readonly': [('full_reserved', '=', True)]}"
                            domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                            widget="product_configurator"
                        />
                        <field name="price_unit" attrs="{'readonly': [('full_reserved', '=', True)]}"/>
                        <field name="order" string="To Sale Order" attrs="{'readonly': [('full_reserved', '=', True)]}"/>
                        <field name="demand" readonly="1"/>
                        <field name="reserved" readonly="1"/>
                        <field name="full_reserved" invisible="1"/>
                    </tree>
                </field>

                <footer>
                <button name="confirm_offer"
                    string="Confirm"
                    type="object"
                    class="oe_highlight"
                    />
                    <button special="cancel" string="Cancel" class="btn-secondary text-center"/>
                </footer>
            </form>
        </field>
    </record>


        <record id="view_building_object_filter" model="ir.ui.view">
            <field name="name">building.object.tree.filter</field>
            <field name="model">building.object</field>
            <field name="priority" eval="15"/>
            <field name="arch" type="xml">
                <search string="Search Building Object">
                    <field name="name"/>
                    <field name="user_id"/>
                    <filter string="My Orders" domain="[('user_id', '=', uid)]" name="my_orders"/>
                    <separator/>
               </search>
            </field>
        </record>


    <record id="view_building_object_tree" model="ir.ui.view">
        <field name="name">building.object.tree</field>
        <field name="model">building.object</field>
        <field name="arch" type="xml">
            <tree string="Building Object">
                <field name="name" decoration-bf="1"/>
                <field name="seq_number"/>
                <field name="date"/>
                <field name="crm_lead_id"/>
                <field name="partner_id"/>
                <field name="user_id"/>
                <field name="property_product_pricelist"/>
                <field name="country_id" optional="show"/>
                <field name="state_id" optional="show"/>
                <field name="city" optional="show"/>
                <field name="street" optional="show"/>
                <field name="zip" optional="show"/>
                <field name="street2" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="action_building_object_open" model="ir.actions.act_window">
        <field name="name">Building Object</field>
        <field name="res_model">building.object</field>
        <field name="search_view_id" ref="view_building_object_filter"/>
        <field name="context">{'search_default_my_orders': 1}</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_building_object_open_tree" model="ir.actions.act_window.view">
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_building_object_tree"/>
    </record>

    <record id="action_building_object_open_form" model="ir.actions.act_window.view">
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_building_object_form"/>
    </record>

    <record model="ir.rule" id="building_object_view_rule">
        <field name="name">Building Object View Rule</field>
        <field name="model_id" ref="model_building_object"/>
        <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]" />
        <field name="domain_force">['|',('user_id','=',user.id),('user_id','=',False)]</field>
    </record>

    <record id="building_object_view_rule_all" model="ir.rule">
        <field name="name">All Orders</field>
        <field ref="model_building_object" name="model_id"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('sales_team.group_sale_manager'))]"/>
    </record>


    <menuitem action="action_building_object_open"
        parent="crm.crm_menu_sales"
        name="Building Object"
        id="menu_action_building_object"
        sequence="11"/>
</odoo>